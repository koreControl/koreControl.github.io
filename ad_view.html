<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Processor</title>
    <style> 
        body { 
            margin: 0; 
            background: #050505; 
            overflow: hidden; 
            font-family: 'Courier New', monospace; 
        }
        
        /* THE HOME SCREEN (COOLING DOWN UI) */
        #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        h2 { color: #00ff00; font-size: 20px; margin-bottom: 5px; text-transform: uppercase; }
        p { color: #888; font-size: 12px; margin-top: 5px; }
        .loader { 
            border: 2px solid #333; 
            border-top: 2px solid #00ff00; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
            display: inline-block; 
            margin-top: 10px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* AD DISPLAY - FULL PAGE */
        #ad-display {
            display: none;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
        }
        #ad-display iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="home-screen">
        <h2 id="status-title">SYSTEM IDLE</h2>
        <p>Next Revenue Cycle: <span id="countdown">--</span>s</p>
        <div class="loader"></div>
    </div>
    
    <div id="ad-display"></div>
    
    <script>
        // --- CONFIGURATION ---
        const smartLink = 'https://www.effectivegatecpm.com/cw1ee9zt3?key=166a8de6e9417228de30d751d42c81fb'; 
        const viewTime = 20000;     // 20 Seconds
        const cooldownTime = 40000; // 40 Seconds
        
        // Get current state from URL
        const params = new URLSearchParams(window.location.search);
        const state = params.get('state') || 'cooldown';
        const startTime = parseInt(params.get('t') || Date.now());
        
        console.log(`State: ${state}, Start: ${startTime}`);
        
        // STATE MACHINE
        if (state === 'ad') {
            showAd();
            
            // FORCE TRANSITION after viewTime
            setTimeout(() => {
                goToCooldown();
            }, viewTime);
            
        } else {
            // Default: cooldown state
            showCooldown();
            
            const elapsed = Date.now() - startTime;
            const remaining = Math.max(0, cooldownTime - elapsed);
            
            setTimeout(() => {
                goToAd();
            }, remaining);
            
            // Countdown display
            startCountdown(Math.ceil(remaining / 1000));
        }
        
        function showAd() {
            document.getElementById('home-screen').style.display = 'none';
            const adDiv = document.getElementById('ad-display');
            adDiv.style.display = 'block';
            
            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.src = smartLink;
            adDiv.appendChild(iframe);
            
            console.log('Ad showing...');
        }
        
        function showCooldown() {
            document.getElementById('home-screen').style.display = 'flex';
            document.getElementById('ad-display').style.display = 'none';
            document.getElementById('status-title').innerText = "COOLING DOWN";
            document.getElementById('status-title').style.color = "orange";
            console.log('Cooldown...');
        }
        
        function goToAd() {
            window.location.href = `?state=ad&t=${Date.now()}`;
        }
        
        function goToCooldown() {
            window.location.href = `?state=cooldown&t=${Date.now()}`;
        }
        
        function startCountdown(seconds) {
            let counter = seconds;
            document.getElementById('countdown').innerText = counter;
            
            const timer = setInterval(() => {
                counter--;
                document.getElementById('countdown').innerText = counter;
                if (counter <= 0) {
                    clearInterval(timer);
                }
            }, 1000);
        }
    </script>
</body>
</html>
